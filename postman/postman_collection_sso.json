{
  "info": {
    "name": "Backend SIKP API (SSO Integrated)",
    "description": "Collection untuk testing Backend SIKP dengan SSO Identity Gateway Integration.\n\nCatatan: Backend SIKP hanya berkomunikasi dengan SSO, tidak langsung ke Profile Service.\n\nAturan wajib: setiap perubahan kode backend harus diikuti update collection ini dan RINGKASAN_BACKEND_SIKP.md pada commit/PR yang sama.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "version": "2.1.0"
  },
  "variable": [
    {
      "key": "ssoBaseUrl",
      "value": "http://localhost:8787",
      "type": "string",
      "description": "SSO Identity Gateway URL"
    },
    {
      "key": "backendSikpUrl",
      "value": "http://localhost:8789",
      "type": "string"
    },
    {
      "key": "accessToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "mahasiswaToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "mahasiswa2Token",
      "value": "",
      "type": "string"
    },
    {
      "key": "adminToken",
      "value": "",
      "type": "string"
    },
    {
      "key": "teamId",
      "value": "",
      "type": "string"
    },
    {
      "key": "invitationId",
      "value": "",
      "type": "string"
    },
    {
      "key": "submissionId",
      "value": "",
      "type": "string"
    }
  ],
  "item": [
    {
      "name": "0. Health Check",
      "item": [
        {
          "name": "SSO Identity Gateway Health",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('SSO Identity Gateway is running', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has correct structure', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('status');",
                  "});",
                  "",
                  "console.log('âœ… SSO Identity Gateway health check passed');"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{ssoBaseUrl}}/health",
              "host": ["{{ssoBaseUrl}}"],
              "path": ["health"]
            }
          }
        },
        {
          "name": "Profile Service Health (via SSO)",
          "description": "Note: Backend SIKP tidak mengakses Profile Service langsung. Test ini untuk memastikan SSO dapat mengakses Profile Service.",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Profile Service is accessible via SSO', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has correct structure', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('status');",
                  "});",
                  "",
                  "console.log('âœ… Profile Service health check passed (via SSO)');"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{ssoBaseUrl}}/profile/health",
              "host": ["{{ssoBaseUrl}}"],
              "path": ["profile", "health"]
            }
          }
        },
        {
          "name": "Backend SIKP Health",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Backend SIKP is running', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has correct structure', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('status');",
                  "    pm.expect(jsonData.status).to.eql('healthy');",
                  "});",
                  "",
                  "pm.test('SSO is enabled', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData).to.have.property('ssoEnabled');",
                  "    pm.expect(jsonData.ssoEnabled).to.be.true;",
                  "});",
                  "",
                  "console.log('âœ… Backend SIKP health check passed');"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{backendSikpUrl}}/health",
              "host": ["{{backendSikpUrl}}"],
              "path": ["health"]
            }
          }
        }
      ]
    },
    {
      "name": "1. SSO - Register & Login",
      "description": "Register dan login via SSO Identity Gateway",
      "item": [
        {
          "name": "Register Mahasiswa 1 (Leader)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Registration successful', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([201, 409]);",
                  "});",
                  "",
                  "if (pm.response.code === 201) {",
                  "    pm.test('Response has success true', function () {",
                  "        const jsonData = pm.response.json();",
                  "        pm.expect(jsonData.success).to.be.true;",
                  "    });",
                  "    ",
                  "    pm.test('User data is present', function () {",
                  "        const jsonData = pm.response.json();",
                  "        pm.expect(jsonData.data).to.have.property('user');",
                  "        pm.expect(jsonData.data.user).to.have.property('id');",
                  "        pm.expect(jsonData.data.user).to.have.property('email');",
                  "        pm.expect(jsonData.data.user.email).to.eql('mahasiswa1@student.unsri.ac.id');",
                  "    });",
                  "    ",
                  "    console.log('âœ… Mahasiswa 1 registered successfully');",
                  "} else if (pm.response.code === 409) {",
                  "    console.log('âš ï¸ Mahasiswa 1 already exists (409)');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"mahasiswa1@student.unsri.ac.id\",\n  \"password\": \"Password123!\",\n  \"role\": \"mahasiswa\",\n  \"nim\": \"09021182025001\"\n}"
            },
            "url": {
              "raw": "{{ssoBaseUrl}}/api/auth/register",
              "host": ["{{ssoBaseUrl}}"],
              "path": ["api", "auth", "register"]
            }
          }
        },
        {
          "name": "Register Mahasiswa 2 (Member)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Registration successful', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([201, 409]);",
                  "});",
                  "",
                  "if (pm.response.code === 201) {",
                  "    pm.test('Response has success true', function () {",
                  "        const jsonData = pm.response.json();",
                  "        pm.expect(jsonData.success).to.be.true;",
                  "    });",
                  "    ",
                  "    pm.test('User data is present', function () {",
                  "        const jsonData = pm.response.json();",
                  "        pm.expect(jsonData.data.user.email).to.eql('mahasiswa2@student.unsri.ac.id');",
                  "    });",
                  "    ",
                  "    console.log('âœ… Mahasiswa 2 registered successfully');",
                  "} else if (pm.response.code === 409) {",
                  "    console.log('âš ï¸ Mahasiswa 2 already exists (409)');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"mahasiswa2@student.unsri.ac.id\",\n  \"password\": \"Password123!\",\n  \"role\": \"mahasiswa\",\n  \"nim\": \"09021182025002\"\n}"
            },
            "url": {
              "raw": "{{ssoBaseUrl}}/api/auth/register",
              "host": ["{{ssoBaseUrl}}"],
              "path": ["api", "auth", "register"]
            }
          }
        },
        {
          "name": "Register Admin",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Registration successful', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([201, 409]);",
                  "});",
                  "",
                  "if (pm.response.code === 201) {",
                  "    pm.test('Response has success true', function () {",
                  "        const jsonData = pm.response.json();",
                  "        pm.expect(jsonData.success).to.be.true;",
                  "    });",
                  "    ",
                  "    pm.test('Admin user has correct role', function () {",
                  "        const jsonData = pm.response.json();",
                  "        pm.expect(jsonData.data.user.roles).to.include('admin');",
                  "    });",
                  "    ",
                  "    console.log('âœ… Admin registered successfully');",
                  "} else if (pm.response.code === 409) {",
                  "    console.log('âš ï¸ Admin already exists (409)');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"admin@unsri.ac.id\",\n  \"password\": \"Admin123!\",\n  \"role\": \"admin\",\n  \"nip\": \"199001012020121001\"\n}"
            },
            "url": {
              "raw": "{{ssoBaseUrl}}/api/auth/register",
              "host": ["{{ssoBaseUrl}}"],
              "path": ["api", "auth", "register"]
            }
          }
        },
        {
          "name": "Login Mahasiswa 1",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Login successful', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has access token', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.data).to.have.property('accessToken');",
                  "    pm.expect(jsonData.data.accessToken).to.be.a('string');",
                  "    pm.expect(jsonData.data.accessToken.length).to.be.greaterThan(0);",
                  "});",
                  "",
                  "pm.test('Token has correct format', function () {",
                  "    const jsonData = pm.response.json();",
                  "    const token = jsonData.data.accessToken;",
                  "    const parts = token.split('.');",
                  "    pm.expect(parts.length).to.eql(3);",
                  "});",
                  "",
                  "pm.test('Response has user data', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data).to.have.property('user');",
                  "    pm.expect(jsonData.data.user).to.have.property('email');",
                  "    pm.expect(jsonData.data.user).to.have.property('roles');",
                  "});",
                  "",
                  "pm.test('Expires in is present', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data).to.have.property('expiresIn');",
                  "    pm.expect(jsonData.data.expiresIn).to.be.a('number');",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    const jsonData = pm.response.json();",
                  "    pm.collectionVariables.set('mahasiswaToken', jsonData.data.accessToken);",
                  "    pm.collectionVariables.set('accessToken', jsonData.data.accessToken);",
                  "    console.log('âœ… Mahasiswa 1 logged in - Token saved');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"mahasiswa1@student.unsri.ac.id\",\n  \"password\": \"Password123!\"\n}"
            },
            "url": {
              "raw": "{{ssoBaseUrl}}/api/auth/login",
              "host": ["{{ssoBaseUrl}}"],
              "path": ["api", "auth", "login"]
            }
          }
        },
        {
          "name": "Login Mahasiswa 2",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Login successful', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has access token', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data).to.have.property('accessToken');",
                  "    pm.expect(jsonData.data.accessToken).to.be.a('string');",
                  "});",
                  "",
                  "pm.test('Response has user data', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.user.email).to.eql('mahasiswa2@student.unsri.ac.id');",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    const jsonData = pm.response.json();",
                  "    pm.collectionVariables.set('mahasiswa2Token', jsonData.data.accessToken);",
                  "    console.log('âœ… Mahasiswa 2 logged in - Token saved');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"mahasiswa2@student.unsri.ac.id\",\n  \"password\": \"Password123!\"\n}"
            },
            "url": {
              "raw": "{{ssoBaseUrl}}/api/auth/login",
              "host": ["{{ssoBaseUrl}}"],
              "path": ["api", "auth", "login"]
            }
          }
        },
        {
          "name": "Login Admin",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Login successful', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has access token', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data).to.have.property('accessToken');",
                  "    pm.expect(jsonData.data.accessToken).to.be.a('string');",
                  "});",
                  "",
                  "pm.test('Admin has correct role', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.user.roles).to.include('admin');",
                  "});",
                  "",
                  "if (pm.response.code === 200) {",
                  "    const jsonData = pm.response.json();",
                  "    pm.collectionVariables.set('adminToken', jsonData.data.accessToken);",
                  "    console.log('âœ… Admin logged in - Token saved');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"admin@unsri.ac.id\",\n  \"password\": \"Admin123!\"\n}"
            },
            "url": {
              "raw": "{{ssoBaseUrl}}/api/auth/login",
              "host": ["{{ssoBaseUrl}}"],
              "path": ["api", "auth", "login"]
            }
          }
        }
      ]
    },
    {
      "name": "2. Backend SIKP - User Info (via SSO)",
      "description": "Get user info via Backend SIKP yang proxy ke SSO /profile endpoint",
      "item": [
        {
          "name": "Get My Info (Mahasiswa)",
          "description": "Get user profile via Backend SIKP (proxied from SSO /profile endpoint)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Request successful', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response structure is correct (SSO format)', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.data).to.have.property('sub');",
                  "    pm.expect(jsonData.data).to.have.property('email');",
                  "    pm.expect(jsonData.data).to.have.property('name');",
                  "    pm.expect(jsonData.data).to.have.property('roles');",
                  "});",
                  "",
                  "pm.test('User has mahasiswa role', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.roles).to.include('mahasiswa');",
                  "});",
                  "",
                  "pm.test('Mahasiswa profile from SSO present', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data).to.have.property('mahasiswa');",
                  "    ",
                  "    if (jsonData.data.mahasiswa) {",
                  "        const mahasiswa = jsonData.data.mahasiswa;",
                  "        pm.expect(mahasiswa).to.have.property('nim');",
                  "        pm.expect(mahasiswa).to.have.property('prodi');",
                  "        pm.expect(mahasiswa).to.have.property('fakultas');",
                  "    }",
                  "});",
                  "",
                  "console.log('✅ User info retrieved successfully (via SSO)');"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{mahasiswaToken}}"
              }
            ],
            "url": {
              "raw": "{{backendSikpUrl}}/api/auth/me",
              "host": ["{{backendSikpUrl}}"],
              "path": ["api", "auth", "me"]
            }
          }
        }
      ]
    },
    {
      "name": "3. Team Management",
      "item": [
        {
          "name": "Create Team (Leader)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "// âœ… Accept both 201 (created) and 409 (conflict - team already exists)",
                  "pm.test('Team creation or already exists', function () {",
                  "    pm.expect(pm.response.code).to.be.oneOf([201, 409]);",
                  "});",
                  "",
                  "if (pm.response.code === 201) {",
                  "    pm.test('Response has success true', function () {",
                  "        const jsonData = pm.response.json();",
                  "        pm.expect(jsonData.success).to.be.true;",
                  "    });",
                  "    ",
                  "    pm.test('Team data structure is correct', function () {",
                  "        const jsonData = pm.response.json();",
                  "        pm.expect(jsonData.data).to.have.property('id');",
                  "        pm.expect(jsonData.data).to.have.property('code');",
                  "        pm.expect(jsonData.data).to.have.property('leaderId');",
                  "        pm.expect(jsonData.data).to.have.property('status');",
                  "    });",
                  "    ",
                  "    pm.test('Team code is generated', function () {",
                  "        const jsonData = pm.response.json();",
                  "        pm.expect(jsonData.data.code).to.match(/^[A-Z0-9]+$/);",
                  "    });",
                  "    ",
                  "    pm.test('Initial status is PENDING', function () {",
                  "        const jsonData = pm.response.json();",
                  "        pm.expect(jsonData.data.status).to.eql('PENDING');",
                  "    });",
                  "    ",
                  "    const jsonData = pm.response.json();",
                  "    pm.collectionVariables.set('teamId', jsonData.data.id);",
                  "    console.log('âœ… Team created with ID:', jsonData.data.id);",
                  "    console.log('âœ… Team code:', jsonData.data.code);",
                  "} else if (pm.response.code === 409) {",
                  "    // Team already exists - this is expected and OK",
                  "    pm.test('Conflict response structure', function () {",
                  "        const jsonData = pm.response.json();",
                  "        pm.expect(jsonData.success).to.be.false;",
                  "        pm.expect(jsonData.message).to.be.a('string');",
                  "        pm.expect(jsonData.message.toLowerCase()).to.satisfy(function(msg) {",
                  "            return msg.includes('already') || msg.includes('sudah');",
                  "        }, 'Message should indicate team already exists');",
                  "    });",
                  "    ",
                  "    console.log('âš ï¸ Team already exists (409 Conflict) - This is expected');",
                  "    console.log('â„¹ï¸ Will retrieve teamId from \"Get My Team\" request');",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{mahasiswaToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": ""
            },
            "url": {
              "raw": "{{backendSikpUrl}}/api/teams",
              "host": ["{{backendSikpUrl}}"],
              "path": ["api", "teams"]
            }
          }
        },
        {
          "name": "Get My Team",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Request successful', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Team data is present', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.data).to.have.property('id');",
                  "    pm.expect(jsonData.data).to.have.property('code');",
                  "    pm.expect(jsonData.data).to.have.property('members');",
                  "});",
                  "",
                  "pm.test('Team has members array', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.members).to.be.an('array');",
                  "    pm.expect(jsonData.data.members.length).to.be.greaterThan(0);",
                  "});",
                  "",
                  "pm.test('Leader is in members', function () {",
                  "    const jsonData = pm.response.json();",
                  "    const leaderMember = jsonData.data.members.find(m => m.role === 'KETUA');",
                  "    pm.expect(leaderMember).to.not.be.undefined;",
                  "    pm.expect(leaderMember.status).to.eql('ACCEPTED');",
                  "});",
                  "",
                  "// Always save teamId from this response as fallback",
                  "const jsonData = pm.response.json();",
                  "if (jsonData.data && jsonData.data.id) {",
                  "    pm.collectionVariables.set('teamId', jsonData.data.id);",
                  "    console.log('âœ… Team retrieved - TeamId saved:', jsonData.data.id);",
                  "}",
                  "",
                  "console.log('âœ… Team retrieved successfully');"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{mahasiswaToken}}"
              }
            ],
            "url": {
              "raw": "{{backendSikpUrl}}/api/teams/my-team",
              "host": ["{{backendSikpUrl}}"],
              "path": ["api", "teams", "my-team"]
            }
          }
        },
        {
          "name": "Invite Member (by NIM)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Invitation sent successfully', function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test('Response has success true', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "});",
                  "",
                  "pm.test('Invitation data is present', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data).to.have.property('id');",
                  "    pm.expect(jsonData.data).to.have.property('teamId');",
                  "    pm.expect(jsonData.data).to.have.property('userId');",
                  "    pm.expect(jsonData.data).to.have.property('invitationStatus');",
                  "});",
                  "",
                  "pm.test('Initial status is PENDING', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.invitationStatus).to.eql('PENDING');",
                  "});",
                  "",
                  "pm.test('Role is ANGGOTA', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.role).to.eql('ANGGOTA');",
                  "});",
                  "",
                  "if (pm.response.code === 201) {",
                  "    const jsonData = pm.response.json();",
                  "    pm.collectionVariables.set('invitationId', jsonData.data.id);",
                  "    console.log('âœ… Invitation sent with ID:', jsonData.data.id);",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{mahasiswaToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"memberNim\": \"09021182025002\"\n}"
            },
            "url": {
              "raw": "{{backendSikpUrl}}/api/teams/{{teamId}}/invite",
              "host": ["{{backendSikpUrl}}"],
              "path": ["api", "teams", "{{teamId}}", "invite"]
            }
          }
        },
        {
          "name": "Get My Invitations (Member)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Request successful', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has invitations array', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.data).to.be.an('array');",
                  "});",
                  "",
                  "pm.test('Invitation has team info', function () {",
                  "    const jsonData = pm.response.json();",
                  "    if (jsonData.data.length > 0) {",
                  "        const invitation = jsonData.data[0];",
                  "        pm.expect(invitation).to.have.property('id');",
                  "        pm.expect(invitation).to.have.property('team');",
                  "        pm.expect(invitation).to.have.property('status');",
                  "    }",
                  "});",
                  "",
                  "console.log('âœ… Invitations retrieved successfully');"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{mahasiswa2Token}}"
              }
            ],
            "url": {
              "raw": "{{backendSikpUrl}}/api/teams/my-invitations",
              "host": ["{{backendSikpUrl}}"],
              "path": ["api", "teams", "my-invitations"]
            }
          }
        },
        {
          "name": "Accept Invitation",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Invitation accepted successfully', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has success true', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "});",
                  "",
                  "pm.test('Status updated to ACCEPTED', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.status).to.eql('ACCEPTED');",
                  "});",
                  "",
                  "console.log('âœ… Invitation accepted');"
                ]
              }
            }
          ],
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{mahasiswa2Token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"accept\": true\n}"
            },
            "url": {
              "raw": "{{backendSikpUrl}}/api/teams/members/{{invitationId}}/respond",
              "host": ["{{backendSikpUrl}}"],
              "path": ["api", "teams", "members", "{{invitationId}}", "respond"]
            }
          }
        },
        {
          "name": "Reject Invitation",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Invitation rejected successfully', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Status updated to REJECTED', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.status).to.eql('REJECTED');",
                  "});",
                  "",
                  "console.log('âœ… Invitation rejected');"
                ]
              }
            }
          ],
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{mahasiswa2Token}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"accept\": false\n}"
            },
            "url": {
              "raw": "{{backendSikpUrl}}/api/teams/members/{{invitationId}}/respond",
              "host": ["{{backendSikpUrl}}"],
              "path": ["api", "teams", "members", "{{invitationId}}", "respond"]
            }
          }
        },
        {
          "name": "Leave Team",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Left team successfully', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response confirms leaving', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.data).to.have.property('teamId');",
                  "});",
                  "",
                  "console.log('âœ… Successfully left team');"
                ]
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{mahasiswa2Token}}"
              }
            ],
            "url": {
              "raw": "{{backendSikpUrl}}/api/teams/leave",
              "host": ["{{backendSikpUrl}}"],
              "path": ["api", "teams", "leave"]
            }
          }
        },
        {
          "name": "Cancel Invitation (Leader)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Invitation cancelled successfully', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response confirms cancellation', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "});",
                  "",
                  "console.log('âœ… Invitation cancelled');"
                ]
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{mahasiswaToken}}"
              }
            ],
            "url": {
              "raw": "{{backendSikpUrl}}/api/teams/invitations/{{invitationId}}/cancel",
              "host": ["{{backendSikpUrl}}"],
              "path": ["api", "teams", "invitations", "{{invitationId}}", "cancel"]
            }
          }
        }
      ]
    },
    {
      "name": "4. Submission Management",
      "item": [
        {
          "name": "Create Submission",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Submission created successfully', function () {",
                  "    pm.response.to.have.status(201);",
                  "});",
                  "",
                  "pm.test('Response has success true', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "});",
                  "",
                  "pm.test('Submission data structure is correct', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data).to.have.property('id');",
                  "    pm.expect(jsonData.data).to.have.property('teamId');",
                  "    pm.expect(jsonData.data).to.have.property('companyName');",
                  "    pm.expect(jsonData.data).to.have.property('status');",
                  "});",
                  "",
                  "pm.test('Initial status is DRAFT', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.status).to.eql('DRAFT');",
                  "});",
                  "",
                  "pm.test('Company name matches', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.companyName).to.eql('PT Telkom Indonesia');",
                  "});",
                  "",
                  "if (pm.response.code === 201) {",
                  "    const jsonData = pm.response.json();",
                  "    pm.collectionVariables.set('submissionId', jsonData.data.id);",
                  "    console.log('âœ… Submission created with ID:', jsonData.data.id);",
                  "}"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{mahasiswaToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"companyName\": \"PT Telkom Indonesia\",\n  \"companyAddress\": \"Jl. Jend. Sudirman No. 1, Palembang\",\n  \"companyPhone\": \"0711-123456\",\n  \"companyEmail\": \"hrd@telkom.co.id\",\n  \"companySupervisor\": \"Budi Santoso\",\n  \"position\": \"Software Engineer Intern\",\n  \"startDate\": \"2026-02-01\",\n  \"endDate\": \"2026-05-01\",\n  \"description\": \"Kerja praktik di divisi IT Development\"\n}"
            },
            "url": {
              "raw": "{{backendSikpUrl}}/api/submissions",
              "host": ["{{backendSikpUrl}}"],
              "path": ["api", "submissions"]
            }
          }
        },
        {
          "name": "Get My Submissions",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Request successful', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has submissions array', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.data).to.be.an('array');",
                  "});",
                  "",
                  "console.log('âœ… Submissions retrieved');"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{mahasiswaToken}}"
              }
            ],
            "url": {
              "raw": "{{backendSikpUrl}}/api/submissions/my-submissions",
              "host": ["{{backendSikpUrl}}"],
              "path": ["api", "submissions", "my-submissions"]
            }
          }
        },
        {
          "name": "Get Submission by ID",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Request successful', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Submission data is complete', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data).to.have.property('id');",
                  "    pm.expect(jsonData.data).to.have.property('companyName');",
                  "    pm.expect(jsonData.data).to.have.property('status');",
                  "});",
                  "",
                  "console.log('âœ… Submission detail retrieved');"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{mahasiswaToken}}"
              }
            ],
            "url": {
              "raw": "{{backendSikpUrl}}/api/submissions/{{submissionId}}",
              "host": ["{{backendSikpUrl}}"],
              "path": ["api", "submissions", "{{submissionId}}"]
            }
          }
        },
        {
          "name": "Update Submission",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Submission updated successfully', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Updated data is reflected', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.companyPhone).to.eql('0711-999888');",
                  "});",
                  "",
                  "console.log('âœ… Submission updated');"
                ]
              }
            }
          ],
          "request": {
            "method": "PATCH",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{mahasiswaToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"companyPhone\": \"0711-999888\",\n  \"description\": \"Kerja praktik di divisi IT Development - Updated\"\n}"
            },
            "url": {
              "raw": "{{backendSikpUrl}}/api/submissions/{{submissionId}}",
              "host": ["{{backendSikpUrl}}"],
              "path": ["api", "submissions", "{{submissionId}}"]
            }
          }
        },
        {
          "name": "Submit for Review",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Submission submitted successfully', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Status changed to MENUNGGU', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.status).to.eql('MENUNGGU');",
                  "});",
                  "",
                  "console.log('âœ… Submission sent for review');"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{mahasiswaToken}}"
              }
            ],
            "url": {
              "raw": "{{backendSikpUrl}}/api/submissions/{{submissionId}}/submit",
              "host": ["{{backendSikpUrl}}"],
              "path": ["api", "submissions", "{{submissionId}}", "submit"]
            }
          }
        }
      ]
    },
    {
      "name": "5. Admin - Review & Approval",
      "item": [
        {
          "name": "Get All Submissions",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Request successful', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Response has submissions array', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.success).to.be.true;",
                  "    pm.expect(jsonData.data).to.be.an('array');",
                  "});",
                  "",
                  "pm.test('Submissions have team info', function () {",
                  "    const jsonData = pm.response.json();",
                  "    if (jsonData.data.length > 0) {",
                  "        const submission = jsonData.data[0];",
                  "        pm.expect(submission).to.have.property('team');",
                  "        pm.expect(submission).to.have.property('companyName');",
                  "    }",
                  "});",
                  "",
                  "console.log('âœ… All submissions retrieved');"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{backendSikpUrl}}/api/admin/submissions",
              "host": ["{{backendSikpUrl}}"],
              "path": ["api", "admin", "submissions"]
            }
          }
        },
        {
          "name": "Get Submissions by Status",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Request successful', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('All submissions have MENUNGGU status', function () {",
                  "    const jsonData = pm.response.json();",
                  "    if (jsonData.data.length > 0) {",
                  "        jsonData.data.forEach(submission => {",
                  "            pm.expect(submission.status).to.eql('MENUNGGU');",
                  "        });",
                  "    }",
                  "});",
                  "",
                  "console.log('âœ… Filtered submissions retrieved');"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{backendSikpUrl}}/api/admin/submissions/status/MENUNGGU",
              "host": ["{{backendSikpUrl}}"],
              "path": ["api", "admin", "submissions", "status", "MENUNGGU"]
            }
          }
        },
        {
          "name": "Get Submission Detail",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Request successful', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Submission detail is complete', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data).to.have.property('id');",
                  "    pm.expect(jsonData.data).to.have.property('team');",
                  "    pm.expect(jsonData.data).to.have.property('companyName');",
                  "});",
                  "",
                  "console.log('âœ… Submission detail retrieved');"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{backendSikpUrl}}/api/admin/submissions/{{submissionId}}",
              "host": ["{{backendSikpUrl}}"],
              "path": ["api", "admin", "submissions", "{{submissionId}}"]
            }
          }
        },
        {
          "name": "Approve Submission",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Submission approved successfully', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Status changed to DITERIMA', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.status).to.eql('DITERIMA');",
                  "});",
                  "",
                  "pm.test('Approved by and at fields are set', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data).to.have.property('approvedBy');",
                  "    pm.expect(jsonData.data).to.have.property('approvedAt');",
                  "});",
                  "",
                  "console.log('âœ… Submission approved');"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{backendSikpUrl}}/api/admin/submissions/{{submissionId}}/approve",
              "host": ["{{backendSikpUrl}}"],
              "path": ["api", "admin", "submissions", "{{submissionId}}", "approve"]
            }
          }
        },
        {
          "name": "Reject Submission",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Submission rejected successfully', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Status changed to DITOLAK', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.status).to.eql('DITOLAK');",
                  "});",
                  "",
                  "pm.test('Rejection reason is saved', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data).to.have.property('rejectionReason');",
                  "});",
                  "",
                  "console.log('âœ… Submission rejected');"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              },
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"rejectionReason\": \"Data perusahaan tidak lengkap, mohon dilengkapi\"\n}"
            },
            "url": {
              "raw": "{{backendSikpUrl}}/api/admin/submissions/{{submissionId}}/reject",
              "host": ["{{backendSikpUrl}}"],
              "path": ["api", "admin", "submissions", "{{submissionId}}", "reject"]
            }
          }
        },
        {
          "name": "Generate Letter",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Letter generated successfully', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Letter URL is provided', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data).to.have.property('letterUrl');",
                  "});",
                  "",
                  "console.log('âœ… Letter generated');"
                ]
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{backendSikpUrl}}/api/admin/submissions/{{submissionId}}/generate-letter",
              "host": ["{{backendSikpUrl}}"],
              "path": ["api", "admin", "submissions", "{{submissionId}}", "generate-letter"]
            }
          }
        },
        {
          "name": "Get Statistics",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Request successful', function () {",
                  "    pm.response.to.have.status(200);",
                  "});",
                  "",
                  "pm.test('Statistics data is present', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data).to.have.property('total');",
                  "    pm.expect(jsonData.data).to.have.property('byStatus');",
                  "});",
                  "",
                  "pm.test('Status counts are numbers', function () {",
                  "    const jsonData = pm.response.json();",
                  "    pm.expect(jsonData.data.total).to.be.a('number');",
                  "});",
                  "",
                  "console.log('âœ… Statistics retrieved');"
                ]
              }
            }
          ],
          "request": {
            "method": "GET",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{backendSikpUrl}}/api/admin/statistics",
              "host": ["{{backendSikpUrl}}"],
              "path": ["api", "admin", "statistics"]
            }
          }
        }
      ]
    }
  ]
}
